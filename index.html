<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>icecoast - east coast snow, terrain, and resort conditions</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNjQiIHZpZXdCb3g9IjAgMCA2NCA2NCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iYmciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KICAgICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzAwNjZGRiIvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDUyQ0MiLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDwhLS0gT3V0ZXIgY2lyY2xlIHdpdGggZ3JhZGllbnQgLS0+CiAgPGNpcmNsZSBjeD0iMzIiIGN5PSIzMiIgcj0iMzAiIGZpbGw9InVybCgjYmcpIiAvPgoKICA8IS0tIExlZnQgc2tpIHdpdGggYmluZGluZyAtLT4KICA8cmVjdCB4PSIyOCIgeT0iNiIgd2lkdGg9IjQiIGhlaWdodD0iNTIiIHJ4PSIyIiByeT0iMiIgZmlsbD0iI0ZGRkZGRiIgdHJhbnNmb3JtPSJyb3RhdGUoLTI4IDMyIDMyKSIgLz4KICA8cmVjdCB4PSIyNyIgeT0iNCIgd2lkdGg9IjUiIGhlaWdodD0iMyIgcng9IjEiIGZpbGw9IiNGRjVBNUYiIHRyYW5zZm9ybT0icm90YXRlKC0yOCAzMiAzMikiIC8+CiAgPHJlY3QgeD0iMjgiIHk9IjI5IiB3aWR0aD0iNCIgaGVpZ2h0PSI2IiByeD0iMSIgZmlsbD0iIzAwQTY5OSIgdHJhbnNmb3JtPSJyb3RhdGUoLTI4IDMyIDMyKSIgLz4KCiAgPCEtLSBSaWdodCBza2kgd2l0aCBiaW5kaW5nIC0tPgogIDxyZWN0IHg9IjMyIiB5PSI2IiB3aWR0aD0iNCIgaGVpZ2h0PSI1MiIgcng9IjIiIHJ5PSIyIiBmaWxsPSIjRkZGRkZGIiB0cmFuc2Zvcm09InJvdGF0ZSgyOCAzMiAzMikiIC8+CiAgPHJlY3QgeD0iMzIiIHk9IjQiIHdpZHRoPSI1IiBoZWlnaHQ9IjMiIHJ4PSIxIiBmaWxsPSIjRkY1QTVGIiB0cmFuc2Zvcm09InJvdGF0ZSgyOCAzMiAzMikiIC8+CiAgPHJlY3QgeD0iMzIiIHk9IjI5IiB3aWR0aD0iNCIgaGVpZ2h0PSI2IiByeD0iMSIgZmlsbD0iIzAwQTY5OSIgdHJhbnNmb3JtPSJyb3RhdGUoMjggMzIgMzIpIiAvPgoKICA8IS0tIENlbnRlciBzbm93IGJ1cnN0IC0tPgogIDxjaXJjbGUgY3g9IjMyIiBjeT0iMzIiIHI9IjQiIGZpbGw9IiNGRkZGRkYiIG9wYWNpdHk9IjAuNCIvPgogIDxjaXJjbGUgY3g9IjMyIiBjeT0iMzIiIHI9IjIiIGZpbGw9IiNGRkZGRkYiLz4KPC9zdmc+">
    <style>
        /* ... [Keep your existing CSS] ... */
        :root { --primary-blue: #0066FF; --ocean-blue: #0052CC; --bg-grey: #F7F7F7; --charcoal: #222222; --white: #FFFFFF; }
        body { font-family: system-ui, sans-serif; background: var(--bg-grey); color: var(--charcoal); }
        .resort-grid { max-width: 1400px; margin: 0 auto; padding: 2rem; display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); }
        .resort-card { background: white; border-radius: 16px; padding: 1.5rem; }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-top">
                <div class="header-left">
                    <h1 class="logo">icecoast<span>.ski</span></h1>
                </div>
                <a href="https://www.patreon.com/icecoastski" target="_blank" class="cta-btn" id="headerCta">Join the Patrol üöÄ</a>
            </div>
        </div>
    </header>

    <div class="sub-header">
        <div class="sub-header-content">
            <p class="sub-tagline">
                No ads. No clutter. Just the snow data you need.<br>
                One dev. 25 years on the tray. Hooked on two planks.
            </p>
        </div>
    </div>

    <div id="resort-container" class="resort-grid">
        <p style="text-align: center; width: 100%;">Loading Fresh Data...</p>
    </div>

    <script>
        // CONFIGURATION
        const WORKER_URL = "YOUR-SUBDOMAIN"; // ‚ö†Ô∏è REPLACE THIS WITH YOUR WORKER URL
        
        let resorts = []; // Will be loaded from JSON

        // 1. Fetch Resort Data
        async function loadResorts() {
            try {
                const response = await fetch('resorts.json');
                if (!response.ok) throw new Error('Failed to load resorts.json');
                resorts = await response.json();
                renderResorts(resorts);
                // After rendering, fetch dynamic data
                fetchWeatherData();
                fetchLiftStatus();
            } catch (error) {
                console.error("Error loading resort data:", error);
                document.getElementById('resort-container').innerHTML = '<p>‚ùÑÔ∏è Error loading resort data. Check console.</p>';
            }
        }

        // 2. Render Cards
        function renderResorts(data) {
            const container = document.getElementById('resort-container');
            container.innerHTML = data.map(resort => `
                <div class="resort-card" data-resort="${resort.id}">
                    <div class="resort-header">
                        <h2>${resort.name}</h2>
                        <span class="location">${resort.location}</span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <span class="label">24h Snow</span>
                            <span class="value">${resort.snowfall.last24}"</span>
                        </div>
                        <div class="stat-box">
                            <span class="label">Conditions</span>
                            <span class="value" style="font-size: 0.9rem">${resort.conditions}</span>
                        </div>
                        <div class="stat-box">
                            <span class="label">Trails</span>
                            <span class="value">${resort.trails.open}/${resort.trails.total}</span>
                        </div>
                        <div class="stat-box">
                            <span class="label">Lifts</span>
                            <span class="value" id="lift-${resort.id}">${resort.lifts.open}/${resort.lifts.total}</span>
                        </div>
                    </div>
                    <div class="weather-row" id="weather-${resort.id}">
                        Loading weather...
                    </div>
                </div>
            `).join('');
        }

        // 3. Fetch Weather (Existing Logic)
        async function fetchWeatherData() {
            try {
                const response = await fetch(`${WORKER_URL}/weather`);
                const weatherData = await response.json();
                
                Object.keys(weatherData).forEach(resortId => {
                    const el = document.getElementById(`weather-${resortId}`);
                    if (el) {
                        const w = weatherData[resortId];
                        el.innerHTML = `üå°Ô∏è ${Math.round(w.temp)}¬∞F | üí® ${Math.round(w.wind)}mph | ${w.description}`;
                    }
                });
            } catch (e) { console.error("Weather fetch failed", e); }
        }

        // 4. Fetch Lifts (Existing Logic)
        async function fetchLiftStatus() {
            try {
                const response = await fetch(`${WORKER_URL}/lifts`);
                const liftData = await response.json();
                
                resorts.forEach(resort => {
                    if (resort.hasLiftie && liftData[resort.id]) {
                        const status = liftData[resort.id];
                        const openLifts = Object.values(status).filter(s => s === 'open').length;
                        const totalLifts = Object.keys(status).length;
                        const el = document.getElementById(`lift-${resort.id}`);
                        if (el) el.textContent = `${openLifts}/${totalLifts}`;
                    }
                });
            } catch (e) { console.error("Lift fetch failed", e); }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', loadResorts);
    </script>
</body>
</html>